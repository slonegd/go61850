{
  "package": "cotp",
  "description": "Connection-Oriented Transport Protocol (COTP) implementation according to ISO 8073, used in IEC 61850 for data transmission over TCP/IP",
  "imports": [
    "context",
    "errors",
    "fmt",
    "io",
    "github.com/slonegd/go61850/logger"
  ],
  "interfaces": {},
  "types": {
    "Connection": {
      "type": "struct",
      "description": "Represents COTP connection",
      "fields": [
        {"name": "state", "type": "int", "private": true},
        {"name": "remoteRef", "type": "int", "private": true},
        {"name": "localRef", "type": "int", "private": true},
        {"name": "protocolClass", "type": "int", "private": true},
        {"name": "conn", "type": "io.ReadWriteCloser", "private": true},
        {"name": "options", "type": "Options", "private": true},
        {"name": "isLastDataUnit", "type": "bool", "private": true},
        {"name": "payload", "type": "[]byte", "private": true},
        {"name": "writeBuffer", "type": "[]byte", "private": true},
        {"name": "readBuffer", "type": "[]byte", "private": true},
        {"name": "packetSize", "type": "uint16", "private": true},
        {"name": "socketExtBuffer", "type": "[]byte", "private": true},
        {"name": "socketExtFill", "type": "int", "private": true},
        {"name": "logger", "type": "Logger", "private": true}
      ],
      "methods": [
        {"name": "GetTpduSize", "signature": "GetTpduSize() int", "description": "Returns TPDU size in bytes"},
        {"name": "SetTpduSize", "signature": "SetTpduSize(tpduSize int)", "description": "Sets TPDU size in bytes"},
        {"name": "GetRemoteRef", "signature": "GetRemoteRef() int", "description": "Returns remote reference"},
        {"name": "GetLocalRef", "signature": "GetLocalRef() int", "description": "Returns local reference"},
        {"name": "GetPayload", "signature": "GetPayload() []byte", "description": "Returns payload buffer"},
        {"name": "ResetPayload", "signature": "ResetPayload()", "description": "Resets payload buffer"},
        {"name": "FlushBuffer", "signature": "FlushBuffer() error", "description": "Flushes extension buffer"},
        {"name": "SendConnectionRequestMessage", "signature": "SendConnectionRequestMessage(params *IsoConnectionParameters) error", "description": "Sends connection request message (client side)"},
        {"name": "SendConnectionResponseMessage", "signature": "SendConnectionResponseMessage() error", "description": "Sends connection response message (server side)"},
        {"name": "ParseIncomingMessage", "signature": "ParseIncomingMessage() (Indication, error)", "description": "Parses incoming message"},
        {"name": "SendDataMessage", "signature": "SendDataMessage(payload []byte) error", "description": "Sends data message with automatic fragmentation"},
        {"name": "ReadToTpktBuffer", "signature": "ReadToTpktBuffer(ctx context.Context) (TpktState, error)", "description": "Reads data into TPKT buffer, checks context before blocking read operations"}
      ]
    },
    "TSelector": {
      "type": "struct",
      "description": "Represents transport selector",
      "fields": [
        {"name": "Value", "type": "[]byte"}
      ]
    },
    "Options": {
      "type": "struct",
      "description": "Represents COTP connection options",
      "fields": [
        {"name": "TSelSrc", "type": "TSelector"},
        {"name": "TSelDst", "type": "TSelector"},
        {"name": "TpduSize", "type": "uint8", "description": "TPDU size as power of two"}
      ]
    },
    "IsoConnectionParameters": {
      "type": "struct",
      "description": "Represents ISO connection parameters",
      "fields": [
        {"name": "RemoteTSelector", "type": "TSelector"},
        {"name": "LocalTSelector", "type": "TSelector"}
      ]
    },
    "Indication": {
      "type": "int",
      "description": "Represents result of COTP operation",
      "constants": [
        {"name": "IndicationOK", "value": 0, "description": "Operation successful"},
        {"name": "IndicationError", "value": 1, "description": "Error"},
        {"name": "IndicationConnect", "value": 2, "description": "Connection indication"},
        {"name": "IndicationData", "value": 3, "description": "Data indication"},
        {"name": "IndicationDisconnect", "value": 4, "description": "Disconnect indication"},
        {"name": "IndicationMoreFragmentsFollow", "value": 5, "description": "More fragments follow"}
      ]
    },
    "TpktState": {
      "type": "int",
      "description": "Represents TPKT packet reading state",
      "constants": [
        {"name": "TpktPacketComplete", "value": 0, "description": "Packet fully read"},
        {"name": "TpktWaiting", "value": 1, "description": "Waiting for data"},
        {"name": "TpktError", "value": 2, "description": "Read error"}
      ]
    },
    "ConnectionOption": {
      "type": "func(*connectionOptions)",
      "description": "Function type for Connection configuration options"
    },
    "TPKT": {
      "type": "struct",
      "description": "Represents TPKT (RFC 1006) packet",
      "fields": [
        {"name": "Version", "type": "uint8", "description": "Protocol version (usually 3)"},
        {"name": "Reserved", "type": "uint8", "description": "Reserved field (usually 0)"},
        {"name": "Length", "type": "uint16", "description": "Packet length in bytes"},
        {"name": "Data", "type": "[]byte", "description": "Data of next level (COTP)"}
      ],
      "methods": [
        {"name": "String", "signature": "String() string", "description": "Implements fmt.Stringer interface"}
      ]
    },
    "COTPType": {
      "type": "uint8",
      "description": "Represents COTP TPDU type",
      "constants": [
        {"name": "COTPTypeData", "value": 240, "description": "Data TPDU (0xf0)"},
        {"name": "COTPTypeConnectionRequest", "value": 224, "description": "Connection Request (0xe0)"},
        {"name": "COTPTypeConnectionConfirm", "value": 208, "description": "Connection Confirm (0xd0)"},
        {"name": "COTPTypeDisconnectRequest", "value": 128, "description": "Disconnect Request (0x80)"},
        {"name": "COTPTypeDisconnectConfirm", "value": 192, "description": "Disconnect Confirm (0xc0)"}
      ]
    },
    "COTP": {
      "type": "struct",
      "description": "Represents COTP (ISO 8073/X.224) packet",
      "fields": [
        {"name": "Length", "type": "uint8", "description": "TPDU length (without Length field)"},
        {"name": "Type", "type": "COTPType", "description": "TPDU type"},
        {"name": "Flags", "type": "uint8", "description": "Flags (for Data TPDU: bit 7 = Last Data Unit)"},
        {"name": "IsLastDataUnit", "type": "bool", "description": "Last data unit flag (for Data TPDU)"},
        {"name": "DestRef", "type": "uint16", "description": "Destination reference (2 bytes)"},
        {"name": "SrcRef", "type": "uint16", "description": "Source reference (2 bytes)"},
        {"name": "Class", "type": "uint8", "description": "Class (4 старших бита из reference, биты 15-12)"},
        {"name": "ExtendedFormats", "type": "bool", "description": "Extended formats (бит 1 из reference)"},
        {"name": "NoExplicitFlowCtrl", "type": "bool", "description": "No explicit flow control (бит 0 из reference)"},
        {"name": "ProtocolClass", "type": "uint8", "description": "Protocol class (for ConnectionConfirm/Request)"},
        {"name": "TpduSize", "type": "uint8", "description": "TPDU size from parameter 0xc0"},
        {"name": "DstTSAP", "type": "[]byte", "description": "Destination TSAP from parameter 0xc2"},
        {"name": "SrcTSAP", "type": "[]byte", "description": "Source TSAP from parameter 0xc1"},
        {"name": "Data", "type": "[]byte", "description": "Data of next level (Session)"}
      ],
      "methods": [
        {"name": "String", "signature": "String() string", "description": "Implements fmt.Stringer interface"}
      ]
    }
  },
  "constants": {
    "tpktRFC1006HeaderSize": {"value": 4, "type": "int"},
    "cotpDataHeaderSize": {"value": 3, "type": "int"},
    "cotpMaxTpduSize": {"value": 8192, "type": "int"},
    "defaultPayloadBufferSize": {"value": 8192, "type": "int"},
    "defaultReadBufferSize": {"value": 8192, "type": "int"},
    "defaultWriteBufferSize": {"value": 8192, "type": "int"},
    "defaultSocketExtBufferSize": {"value": 8192, "type": "int"}
  },
  "functions": [
    {
      "name": "NewConnection",
      "signature": "NewConnection(conn io.ReadWriteCloser, opts ...ConnectionOption) *Connection",
      "description": "Creates new COTP connection"
    },
    {
      "name": "WithPayloadBufferSize",
      "signature": "WithPayloadBufferSize(size int) ConnectionOption",
      "description": "Sets payload buffer size"
    },
    {
      "name": "WithReadBufferSize",
      "signature": "WithReadBufferSize(size int) ConnectionOption",
      "description": "Sets read buffer size"
    },
    {
      "name": "WithWriteBufferSize",
      "signature": "WithWriteBufferSize(size int) ConnectionOption",
      "description": "Sets write buffer size"
    },
    {
      "name": "WithSocketExtBufferSize",
      "signature": "WithSocketExtBufferSize(size int) ConnectionOption",
      "description": "Sets socket extension buffer size"
    },
    {
      "name": "WithLogger",
      "signature": "WithLogger(logger Logger) ConnectionOption",
      "description": "Sets logger for debugging"
    },
    {
      "name": "ParseTPKT",
      "signature": "ParseTPKT(data []byte) (*TPKT, error)",
      "description": "Parses TPKT packet from byte buffer"
    },
    {
      "name": "ParseCOTP",
      "signature": "ParseCOTP(data []byte) (*COTP, error)",
      "description": "Parses COTP packet from byte buffer"
    }
  ]
}

